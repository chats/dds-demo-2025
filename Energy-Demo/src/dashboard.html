<!DOCTYPE html>
<html>
<head>
    <title>Power Plant Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background: #f0f2f5; font-family: Arial, sans-serif; }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .data-table th, .data-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="grid">
        <div class="card">
            <h2>Real-time Power Output</h2>
            <canvas id="powerChart"></canvas>
        </div>
        <div class="card">
            <h2>Plants Data</h2>
            <table class="data-table" id="plantsTable">
                <thead>
                    <tr>
                        <th>Plant ID</th>
                        <th>Type</th>
                        <th>Location</th>
                        <th>Power (kW)</th>
                        <th>Energy (kWh)</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        let powerChart;
        const powerData = {
            labels: [],
            datasets: [{
                label: 'Power Output (kW)',
                data: [],
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        };

        function initChart() {
            const ctx = document.getElementById('powerChart').getContext('2d');
            powerChart = new Chart(ctx, {
                type: 'line',
                data: powerData,
                options: {
                    responsive: true,
                    animation: false
                }
            });
        }

        function updateTable(data) {
            const tbody = document.querySelector('#plantsTable tbody');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${data.plant_id}</td>
                <td>${data.type}</td>
                <td>${data.location}</td>
                <td>${data.power.toFixed(2)}</td>
                <td>${data.energy.toFixed(2)}</td>
            `;
            tbody.innerHTML = ''; // Clear existing rows
            tbody.appendChild(row);

            // Update chart
            const now = new Date().toLocaleTimeString();
            powerData.labels.push(now);
            powerData.datasets[0].data.push(data.power);
            
            if (powerData.labels.length > 10) {
                powerData.labels.shift();
                powerData.datasets[0].data.shift();
            }
            
            powerChart.update();
        }

        const ws = new WebSocket('ws://localhost:8080/energy-data');
        
        ws.onopen = () => {
            console.log('Connected to WebSocket server');
            initChart();
        };
        
        ws.onmessage = (event) => {
            console.log('Received:', event.data);
            try {
                const data = JSON.parse(event.data);
                updateTable(data);
            } catch (e) {
                console.error('Error parsing data:', e);
            }
        };

        ws.onerror = (error) => {
            console.error('WebSocket error:', error);
        };

        ws.onclose = () => {
            console.log('Disconnected from WebSocket server');
        };
    </script>
</body>
</html>